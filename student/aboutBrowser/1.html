<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>从输入url到页面加载完成究竟发生了什么？ | cc的学习笔记</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="我的博客">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="preload" href="/myblog/assets/css/0.styles.3e211e95.css" as="style"><link rel="preload" href="/myblog/assets/js/app.41615b56.js" as="script"><link rel="preload" href="/myblog/assets/js/2.814e5817.js" as="script"><link rel="preload" href="/myblog/assets/js/5.f5e1ad52.js" as="script"><link rel="prefetch" href="/myblog/assets/js/10.ca316200.js"><link rel="prefetch" href="/myblog/assets/js/11.d8631f6b.js"><link rel="prefetch" href="/myblog/assets/js/12.a488b497.js"><link rel="prefetch" href="/myblog/assets/js/13.3cc6a402.js"><link rel="prefetch" href="/myblog/assets/js/14.c9a0d417.js"><link rel="prefetch" href="/myblog/assets/js/15.475a2b37.js"><link rel="prefetch" href="/myblog/assets/js/16.8a9137fb.js"><link rel="prefetch" href="/myblog/assets/js/17.9a7498ec.js"><link rel="prefetch" href="/myblog/assets/js/18.b5be574f.js"><link rel="prefetch" href="/myblog/assets/js/19.597126ba.js"><link rel="prefetch" href="/myblog/assets/js/20.839a0cd8.js"><link rel="prefetch" href="/myblog/assets/js/21.89da595b.js"><link rel="prefetch" href="/myblog/assets/js/22.90439cc7.js"><link rel="prefetch" href="/myblog/assets/js/23.ae6ca502.js"><link rel="prefetch" href="/myblog/assets/js/24.aaa25a26.js"><link rel="prefetch" href="/myblog/assets/js/25.18fef18d.js"><link rel="prefetch" href="/myblog/assets/js/26.d7948f7a.js"><link rel="prefetch" href="/myblog/assets/js/3.e7373026.js"><link rel="prefetch" href="/myblog/assets/js/4.3743e7be.js"><link rel="prefetch" href="/myblog/assets/js/6.41cb4bea.js"><link rel="prefetch" href="/myblog/assets/js/7.dd730ae1.js"><link rel="prefetch" href="/myblog/assets/js/8.21240742.js"><link rel="prefetch" href="/myblog/assets/js/9.43ca0555.js">
    <link rel="stylesheet" href="/myblog/assets/css/0.styles.3e211e95.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/myblog/" class="home-link router-link-active"><!----> <span class="site-name">cc的学习笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/myblog/student/" class="nav-link router-link-active">
  笔记
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/myblog/student/" class="nav-link router-link-active">
  笔记
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>js进阶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/student/jsProgress/1.html" class="sidebar-link">执行上下文相关</a></li><li><a href="/myblog/student/jsProgress/2.html" class="sidebar-link">异步编程</a></li><li><a href="/myblog/student/jsProgress/3.html" class="sidebar-link">原型与原型链</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>js性能与规范</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/student/jsPref/1.html" class="sidebar-link">js设计模式</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>浏览器相关知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/student/aboutBrowser/1.html" class="active sidebar-link">从输入url到页面加载完成究竟发生了什么？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/student/aboutBrowser/1.html#url是什么" class="sidebar-link">URL是什么</a></li><li class="sidebar-sub-header"><a href="/myblog/student/aboutBrowser/1.html#dns域名解析" class="sidebar-link">DNS域名解析</a></li><li class="sidebar-sub-header"><a href="/myblog/student/aboutBrowser/1.html#tcp连接" class="sidebar-link">TCP连接</a></li><li class="sidebar-sub-header"><a href="/myblog/student/aboutBrowser/1.html#http请求" class="sidebar-link">http请求</a></li><li class="sidebar-sub-header"><a href="/myblog/student/aboutBrowser/1.html#浏览器渲染" class="sidebar-link">浏览器渲染</a></li><li class="sidebar-sub-header"><a href="/myblog/student/aboutBrowser/1.html#四次挥手关闭连接" class="sidebar-link">四次挥手关闭连接</a></li></ul></li><li><a href="/myblog/student/aboutBrowser/2.html" class="sidebar-link">同源策略和跨域</a></li><li><a href="/myblog/student/aboutBrowser/3.html" class="sidebar-link">浏览器缓存</a></li><li><a href="/myblog/student/aboutBrowser/4.html" class="sidebar-link">http请求协议相关</a></li><li><a href="/myblog/student/aboutBrowser/5.html" class="sidebar-link">浏览器渲染原理</a></li><li><a href="/myblog/student/aboutBrowser/sumUp.html" class="sidebar-link">页面性能优化相关</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>webpack</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/student/webpack/base.html" class="sidebar-link">webpack基本概念</a></li><li><a href="/myblog/student/webpack/1.html" class="sidebar-link">webpack基本配置</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="从输入url到页面加载完成究竟发生了什么？"><a href="#从输入url到页面加载完成究竟发生了什么？" class="header-anchor">#</a> 从输入url到页面加载完成究竟发生了什么？</h1> <p>先说一下大致流程。</p> <ol><li><p>浏览器的地址栏输入URL并按下回车。</p></li> <li><p>浏览器查找当前URL是否存在缓存，并比较缓存是否过期。</p></li> <li><p>DNS解析URL对应的IP。</p></li> <li><p>根据IP建立TCP连接（三次握手）。</p></li> <li><p>HTTP发起请求。</p></li> <li><p>服务器处理请求，浏览器接收HTTP响应。</p></li> <li><p>渲染页面，构建DOM树。</p></li> <li><p>关闭TCP连接（四次挥手）。</p></li></ol> <p>接下来对于关键点进行较详细的讲解。</p> <h2 id="url是什么"><a href="#url是什么" class="header-anchor">#</a> URL是什么</h2> <p>简单来说就是网页的一个标识，一个IP的映射。当我们浏览网页的时候，常常需要一个URL地址来访问网页，比如http://www.baidu.com,这由三部分组成：协议名、域名、端口号，由于端口号这边是默认的所以隐藏，比如HTTP默认端口80，HTTPS默认端口443。除此之外URL还会包含一些路径、查询和其他片段，例如：http://www.tuicool.com/search?kw=%E4%。我们最常见的的协议是HTTP协议，除此之外还有加密的HTTPS协议、FTP协议、FILe协议等等。URL的中间部分为域名或者是IP。</p> <p>扩展：<a href="/myblog/student/aboutBrowser/2.html">同源策略和跨域</a></p> <h2 id="dns域名解析"><a href="#dns域名解析" class="header-anchor">#</a> DNS域名解析</h2> <p>因为域名并不是最后资源所存在的真实位置，其只是一个IP的映射。而域名解析的过程实际上就是将域名解析为IP的过程。这个过程如下所示</p> <p>浏览器会首先搜索浏览器自身的DNS缓存（缓存时间比较短，大概只有2分钟左右，且只能容纳1000条缓存）。</p> <p>如果浏览器自身缓存找不到则会查看系统的DNS缓存,如果找到且没有过期则停止搜索解析到此结束.</p> <p>而如果本机没有找到DNS缓存，则浏览器会发起一个DNS的系统调用，就会向本地配置的首选DNS服务器发起域名解析请求（通过的是UDP协议向DNS的53端口发起请求，这个请求是递归的请求，也就是运营商的DNS服务器必须得提供给我们该域名的IP地址），运营商的DNS服务器首先查找自身的缓存，找到对应的条目，且没有过期，则解析成功。</p> <p>如果没有找到对应的条目，则有运营商的DNS代我们的浏览器发起迭代DNS解析请求，它首先是会找根域的DNS的IP地址（这个DNS服务器都内置13台根域的DNS的IP地址），找打根域的DNS地址，就会向其发起请求（请问www.xxxx.com这个域名的IP地址是多少啊？）</p> <p>根域发现这是一个顶级域com域的一个域名，于是就告诉运营商的DNS我不知道这个域名的IP地址，但是我知道com域的IP地址，你去找它去，于是运营商的DNS就得到了com域的IP地址，又向com域的IP地址发起了请求（请问www.xxxx.com这个域名的IP地址是多少?）,com域这台服务器告诉运营商的DNS我不知道www.xxxx.com这个域名的IP地址，但是我知道xxxx.com这个域的DNS地址，你去找它去，于是运营商的DNS又向linux178.com这个域名的DNS地址（这个一般就是由域名注册商提供的，像万网，新网等）发起请求（请问www.xxxx.com这个域名的IP地址是多少？），这个时候xxxx.com域的DNS服务器一查，诶，果真在我这里，于是就把找到的结果发送给运营商的DNS服务器，这个时候运营商的DNS服务器就拿到了www.xxxx.com这个域名对应的IP地址，并返回给Windows系统内核，内核又把结果返回给浏览器，终于浏览器拿到了www.xxxx.com对应的IP地址,这次dns解析圆满成功。</p> <h2 id="tcp连接"><a href="#tcp连接" class="header-anchor">#</a> TCP连接</h2> <p>在通过第一步的域名解析以后，获取到了服务器的IP地址，在获取到IP地址以后，便会开始建立连接。这个过程由TCP协议完成。</p> <p>主要分为3步，也叫做3次握手。</p> <p>第一次握手： 建立连接时，客户端发送syn包（syn=j）到服务器，并进入SYN_SENT状态，等待服务器确认</p> <p>第二次握手： 服务器收到syn包，必须确认客户的SYN（ack=j+1），同时自己也发送一个SYN包（syn=k），即SYN+ACK包，此时服务器进入SYN_RECV状态</p> <p>第三次握手： 客户端收到服务器的SYN+ACK包，向服务器发送确认包ACK(ack=k+1），此包发送完毕，客户端和服务器进入ESTABLISHED（TCP连接成功）状态，完成三次握手。</p> <p>完成连接以后，客户端和服务端开始传送数据。</p> <h2 id="http请求"><a href="#http请求" class="header-anchor">#</a> http请求</h2> <p>关于这一块在<a href="/myblog/student/aboutBrowser/4.html">http请求协议相关</a>讲解</p> <h2 id="浏览器渲染"><a href="#浏览器渲染" class="header-anchor">#</a> 浏览器渲染</h2> <p>这一块知识内容较多，放在<a href="/myblog/student/aboutBrowser/5.html">这里</a>讲解</p> <h2 id="四次挥手关闭连接"><a href="#四次挥手关闭连接" class="header-anchor">#</a> 四次挥手关闭连接</h2> <p>通过四次挥手关闭连接(FIN ACK, ACK, FIN ACK, ACK)。</p> <p><img src="/myblog/assets/img/item4.b2c9955c.png" alt=""></p> <p>第一次挥手是浏览器发完数据后，发送FIN请求断开连接。</p> <p>第二次挥手是服务器发送ACK表示同意，如果在这一次服务器也发送FIN请求断开连接似乎也没有不妥，但考虑到服务器可能还有数据要发送，所以服务器发送FIN应该放在第三次挥手中。</p> <p>这样浏览器需要返回ACK表示同意，也就是第四次挥手。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/myblog/student/jsPref/1.html" class="prev">
        js设计模式
      </a></span> <span class="next"><a href="/myblog/student/aboutBrowser/2.html">
        同源策略和跨域
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/myblog/assets/js/app.41615b56.js" defer></script><script src="/myblog/assets/js/2.814e5817.js" defer></script><script src="/myblog/assets/js/5.f5e1ad52.js" defer></script>
  </body>
</html>
